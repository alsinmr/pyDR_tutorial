

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chapter 1: A brief introduction to detectors &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Ch1_detectors_intro';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chapter 2: Detector Optimization" href="Ch2_detector_opt.html" />
    <link rel="prev" title="Content with notebooks" href="notebooks.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="markdown.html">Markdown Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks.html">Content with notebooks</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#"><font color="maroon"> Chapter 1: A brief introduction to detectors </font></a></li>
<li class="toctree-l1"><a class="reference internal" href="Ch2_detector_opt.html"><font color="maroon">Chapter 2: Detector Optimization</font></a></li>
<li class="toctree-l1"><a class="reference internal" href="markdown-notebooks.html">Notebooks with MyST Markdown</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FCh1_detectors_intro.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Ch1_detectors_intro.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><font color="maroon"> Chapter 1: A brief introduction to detectors </font></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#models-for-decaying-correlation-functions">Models for decaying correlation functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-angular-correlation-function-for-nmr">The angular correlation function for NMR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-dynamics-data">Fitting dynamics data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-detector-theory">Basic detector theory</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tex2jax_ignore mathjax_ignore section" id="font-color-maroon-chapter-1-a-brief-introduction-to-detectors-font">
<h1><font color="maroon"> Chapter 1: A brief introduction to detectors </font><a class="headerlink" href="#font-color-maroon-chapter-1-a-brief-introduction-to-detectors-font" title="Permalink to this heading">#</a></h1>
<div class="section" id="models-for-decaying-correlation-functions">
<h2>Models for decaying correlation functions<a class="headerlink" href="#models-for-decaying-correlation-functions" title="Permalink to this heading">#</a></h2>
<p>Experimental and simulated dynamics information is often assumed to be described based on a time-correlation function, which relates the state of some parameter at an initial time to its value at a later time. The time-correlation is the <em>average</em> of that relationship. For example, for some parameter which varies with time, <span class="math notranslate nohighlight">\(A(\tau)\)</span>, the simplest time-correlation function would be</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
C(t)=\langle X(\tau)\cdot X(t+\tau)\rangle_\tau
\end{equation}
\]</div>
<p>where the brackets (<span class="math notranslate nohighlight">\(\langle\rangle_\tau\)</span>) indication an average over the initial time <span class="math notranslate nohighlight">\(\tau\)</span>.</p>
<p>Then, the time-function often decays in time, indicating that the value of <span class="math notranslate nohighlight">\(X(t+\tau)\)</span> eventually becomes uncorrelated with its value at some earlier time, <span class="math notranslate nohighlight">\(X(\tau)\)</span>. A simple model for this behavior is to assume the correlation function has the form</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
C(t)=\left(\langle X(t)^2\rangle_\tau-\langle X(t)\rangle_\tau^2\right)e^{-t/\tau_c}+\langle X(t)\rangle_\tau^2.
\end{equation}
\]</div>
<p>In this simple case, the correlation time, <span class="math notranslate nohighlight">\(\tau_c\)</span>, indicates how quickly the correlation decays. For motion, a shorter <span class="math notranslate nohighlight">\(\tau_c\)</span> indicates a faster motion, and a longer <span class="math notranslate nohighlight">\(\tau_c\)</span> indicates a slower motion. <span class="math notranslate nohighlight">\(\langle X(\tau)\rangle_\tau\)</span> is simply the average of the parameter <span class="math notranslate nohighlight">\(X(\tau)\)</span>, and (<span class="math notranslate nohighlight">\(\langle X(t)^2\rangle_\tau-\langle X(t)\rangle_\tau^2\)</span>) is its variance (standard deviation squared)</p>
<p>It can be, however, that multiple motions affect the decorrelation, in which case the correlation function can be modeled more generally as</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
C(t)=\langle X(t)\rangle_\tau^2+\sum\limits_i{A_i\exp(-t/\tau_i)}
\end{equation}
\]</div>
<p>In this case, the <span class="math notranslate nohighlight">\(A_i\)</span> add up to the total variance (<span class="math notranslate nohighlight">\(\langle X(t)^2\rangle_\tau-\langle X(t)\rangle_\tau^2\)</span>), but each corresponds to a different correlation time, representing contributions from different motions with varying speeds. This expression suggests a number of discrete motions, but it is also possible to obtain a continuum of correlation times, in which case we would better represent the situation with an infinite number of amplitudes, given as an integral:</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
C(t)=\langle X(t)\rangle_\tau^2+\int\limits_{-\infty}^\infty{\theta(z)\exp(-t/(10^z\cdot1\mathrm{ s})dz}
\end{equation}
\]</div>
<p>In this representation, <span class="math notranslate nohighlight">\(z\)</span> is the log-correlation time (<span class="math notranslate nohighlight">\(z=\log_{10}(\tau_c/\mathrm{s})\)</span>), and <span class="math notranslate nohighlight">\(\theta(z)\)</span> is the distribution of correlation times as a function of the log-correlation time. <span class="math notranslate nohighlight">\(\theta(z)\)</span> must then integrate to the total variance.</p>
</div>
<div class="section" id="the-angular-correlation-function-for-nmr">
<h2>The angular correlation function for NMR<a class="headerlink" href="#the-angular-correlation-function-for-nmr" title="Permalink to this heading">#</a></h2>
<p>In NMR, a major source of relaxation is due to the stochastic reoriention of anisotropy interaction tensors, such as dipole couplings, chemical shift anisotropies (CSA), and quadrupole couplings. Then, we cannot use a strictly linear correlation function, but rather must use the rank-2 tensor correlation function (which can be constructed from a sum of linear correlation functions).</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
C(t)=\left\langle\frac{3\cos^2\beta_{\tau,t+\tau}-1}{2}\right\rangle_\tau
\end{equation}
\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\beta_{\tau,t+\tau}\)</span> is the angle between the z-component of the relevant tensor at some time <span class="math notranslate nohighlight">\(\tau\)</span> and a later time, <span class="math notranslate nohighlight">\(t+\tau\)</span>. For example, for a one-bond dipole coupling, this is just the angle between the bond between the two times <span class="math notranslate nohighlight">\(\tau\)</span> and <span class="math notranslate nohighlight">\(t+\tau\)</span>.</p>
<p>Given the full correlation function, a given relaxation rate constant may be obtained by first calculating the spectral density function, <span class="math notranslate nohighlight">\(J(\omega)\)</span>, which is the Fourier transform of the correlation function</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
J(\omega)=\frac25\int\limits_0^\infty{C(t)\exp(-i\omega t)dt}.
\end{equation}
\]</div>
<p>Then, for example, <span class="math notranslate nohighlight">\(T_1\)</span> relaxation of a <span class="math notranslate nohighlight">\(^{13}\)</span>C nucleus due to a single bonded <span class="math notranslate nohighlight">\(^1\)</span>H and its CSA is given by</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
R_1=\left(\frac{\delta_\mathrm{HC}}{4}\right)^2(J(\omega_\mathrm{H}-\omega_\mathrm{C})+3J(\omega_\mathrm{C})+6J(\omega_\mathrm{H}+\omega_\mathrm{C}))+\frac13(\omega_\mathrm{C}\Delta\sigma)^2J(\omega_\mathrm{C})
\end{equation}
\]</div>
<p>In this equation, <span class="math notranslate nohighlight">\(R_1\)</span> is the longitudinal relaxation rate constant for <span class="math notranslate nohighlight">\(^{13}\)</span>C (<span class="math notranslate nohighlight">\(1/T_1=R_1\)</span>), with <span class="math notranslate nohighlight">\(\delta_\mathrm{HC}\)</span> being the anisotropy of the dipole coupling and <span class="math notranslate nohighlight">\(\Delta\sigma_\mathrm{C}\)</span> the width of the CSA in ppm. The <span class="math notranslate nohighlight">\(J(\omega)\)</span> are sampled at the <span class="math notranslate nohighlight">\(^1\)</span>H and <span class="math notranslate nohighlight">\(^13\)</span>C Larmor frequencies in addition to their sums and differences (given in radians/s).</p>
<p>Usually, relaxation due to reorientational motion can be expressed as a sum over the spectral density sampled at various frequencies:</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
R_\zeta=\sum\limits_i{a_iJ(\omega_i)}
\end{equation}.
\]</div>
<p>The models of the correlation function given above are still valid, but we typically write them as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
C(t)&amp;=&amp;S^2+(1-S^2)\sum\limits_i{A_i\exp(-t/\tau_i}) \\
&amp;=&amp;S^2+(1-S^2)\int\limits_{-\infty}^\infty{\theta(z)\exp(-t/(10^z\cdot\mathrm{ s}))dz}
\end{eqnarray}
\end{split}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(S^2\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
S^2=\lim_{t\rightarrow\infty}C(t)
\end{equation}
\]</div>
</div>
<div class="section" id="fitting-dynamics-data">
<h2>Fitting dynamics data<a class="headerlink" href="#fitting-dynamics-data" title="Permalink to this heading">#</a></h2>
<p>Whether we have NMR data, or other dynamics data depending on some form of time-correlation function, we can, in principle, fit the experimental data based on some model of the correlation function. However, the challenge is, if we don’t know the model, how valuable are these fits? We’ll start by taking some example motion, characterized by 3 motions and calculate a few relaxation rate constants for those motions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import various modules, including the pyDR module</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pyDR</span>   <span class="c1">#Import the pyDR software, which includes functions for calculating NMR relaxation rate constants</span>
<span class="kn">from</span> <span class="nn">pyDR.misc.tools</span> <span class="kn">import</span> <span class="n">linear_ex</span> <span class="c1">#Convenient tool for interpolating between data points</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> <span class="c1">#Lots of nice linear algebra tools</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> <span class="c1">#Plotting tools</span>

<span class="c1">#Zoomable plots with matplotlib notebook</span>
<span class="c1"># %matplotlib notebook</span>

<span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span><span class="o">-</span><span class="mf">9.5</span><span class="p">,</span><span class="o">-</span><span class="mf">7.5</span><span class="p">]</span>  <span class="c1">#These are log-correlation times, corresponding to 10 ps, 1 ns, and 1 μs, respectively</span>
<span class="n">A</span><span class="o">=</span><span class="p">[</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.05</span><span class="p">,</span><span class="mf">.01</span><span class="p">]</span>  <span class="c1">#These are the corresponding amplitudes. The total amplitude of motion is 0.38 (S^2=0.62)</span>

<span class="n">nmr</span><span class="o">=</span><span class="n">pyDR</span><span class="o">.</span><span class="n">Sens</span><span class="o">.</span><span class="n">NMR</span><span class="p">()</span>  <span class="c1">#This is a container for NMR experiments, which give the relaxation rates as a function of z</span>
<span class="n">nmr</span><span class="o">.</span><span class="n">new_exper</span><span class="p">(</span><span class="n">Type</span><span class="o">=</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span><span class="n">v0</span><span class="o">=</span><span class="p">[</span><span class="mi">400</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">800</span><span class="p">],</span><span class="n">Nuc</span><span class="o">=</span><span class="s1">&#39;15N&#39;</span><span class="p">)</span> <span class="c1">#Add 3 experiments: 15N T1 at 400, 600, and 800</span>
<span class="c1">#We assume by default N15 coupled to a single proton (22.954 kHz = 2*11.477) and CSA of 113 ppm (z-component)</span>
<span class="n">nmr</span><span class="o">.</span><span class="n">new_exper</span><span class="p">(</span><span class="n">Type</span><span class="o">=</span><span class="s1">&#39;R1p&#39;</span><span class="p">,</span><span class="n">v0</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span><span class="n">vr</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">Nuc</span><span class="o">=</span><span class="s1">&#39;15N&#39;</span><span class="p">)</span> <span class="c1">#Add an R1p (MAS=60 kHz, spin-lock at 10 kHz)</span>
<span class="n">nmr</span><span class="o">.</span><span class="n">new_exper</span><span class="p">(</span><span class="n">Type</span><span class="o">=</span><span class="s1">&#39;S2&#39;</span><span class="p">)</span>
<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$R_1$(400 MHz)&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$R_1$(600 MHz)&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$R_1$(800 MHz)&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;$R_{1\rho}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$1-S^2$&#39;</span><span class="p">]</span>

<span class="n">ax</span><span class="o">=</span><span class="n">nmr</span><span class="o">.</span><span class="n">plot_Rz</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span> <span class="c1">#Plot the 9 relaxation rate constants (normalized to max of 1) vs tc</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">pyDR</span>   <span class="c1">#Import the pyDR software, which includes functions for calculating NMR relaxation rate constants</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">from</span> <span class="nn">pyDR.misc.tools</span> <span class="kn">import</span> <span class="n">linear_ex</span> <span class="c1">#Convenient tool for interpolating between data points</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> <span class="c1">#Lots of nice linear algebra tools</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;pyDR&#39;
</pre></div>
</div>
</div>
</div>
<p>Now we can construct the relaxation rate constants for the seven experiments above, by simply summing over the three correlation times and amplitudes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmr</span><span class="o">.</span><span class="n">rhoz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1">#Pre-allocate an array with 7 relaxation rates</span>
<span class="k">for</span> <span class="n">z0</span><span class="p">,</span><span class="n">A0</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>    <span class="c1">#Iterate over all correlation times, amplitudes</span>
    <span class="n">R</span><span class="o">+=</span><span class="n">A0</span><span class="o">*</span><span class="n">linear_ex</span><span class="p">(</span><span class="n">nmr</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="n">nmr</span><span class="o">.</span><span class="n">rhoz</span><span class="p">,</span><span class="n">z0</span><span class="p">)</span>

<span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)),</span><span class="n">R</span><span class="p">)</span>
<span class="c1">#Some figure cleanup/labeling</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$R$ / s$^{-1}$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1cbf8828bfd8d16d397e8e17a426e6d457c69ec93c0b8879f3b8726f029e9406.png" src="_images/1cbf8828bfd8d16d397e8e17a426e6d457c69ec93c0b8879f3b8726f029e9406.png" />
</div>
</div>
<p>Now, the question is, can we fit this data based on a model of the correlation function, and does that model have to match the original model. For demonstration purposes, we try a model that only has two correlation times.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Function to calculate relaxation rate constants</span>
<span class="k">def</span> <span class="nf">calcR</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">nmr</span><span class="p">):</span>
    <span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmr</span><span class="o">.</span><span class="n">rhoz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">z0</span><span class="p">,</span><span class="n">A0</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>    <span class="c1">#Iterate over all correlation times, amplitudes</span>
        <span class="n">R</span><span class="o">+=</span><span class="n">A0</span><span class="o">*</span><span class="n">linear_ex</span><span class="p">(</span><span class="n">nmr</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="n">nmr</span><span class="o">.</span><span class="n">rhoz</span><span class="p">,</span><span class="n">z0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span>

<span class="c1">#Function to calculate error of fit</span>
<span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">zf</span><span class="p">,</span><span class="n">Af</span><span class="p">):</span>
    <span class="n">Ri</span><span class="o">=</span><span class="n">calcR</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">nmr</span><span class="p">)</span>
    <span class="n">Rc</span><span class="o">=</span><span class="n">calcR</span><span class="p">(</span><span class="n">zf</span><span class="p">,</span><span class="n">Af</span><span class="p">,</span><span class="n">nmr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Ri</span><span class="o">-</span><span class="n">Rc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Function to use with nonlinear minimization algorithm (needs to have just one argument)</span>
<span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">zf</span><span class="o">=</span><span class="n">x</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">Af</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">error</span><span class="p">(</span><span class="n">zf</span><span class="p">,</span><span class="n">Af</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First, we just try to fit with the original model, i.e. with a tri-exponential decay</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
C(t)=1-(A_0+A_1+A_2)+A_0\exp(-t/\tau_0)+A_1\exp(-t/\tau_1)+A_2\exp(-t/\tau_2)
\end{equation}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span><span class="o">=</span><span class="n">minimize</span><span class="p">(</span><span class="n">fun</span><span class="p">,[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.1</span><span class="p">,</span><span class="mf">.05</span><span class="p">],</span><span class="n">bounds</span><span class="o">=</span><span class="p">([</span><span class="o">-</span><span class="mi">14</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">],[</span><span class="o">-</span><span class="mi">14</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">],[</span><span class="o">-</span><span class="mi">14</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>   
<span class="n">zf</span><span class="p">,</span><span class="n">Af</span><span class="o">=</span><span class="n">fit</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][:</span><span class="mi">3</span><span class="p">],</span><span class="n">fit</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
<span class="n">Rc</span><span class="o">=</span><span class="n">calcR</span><span class="p">(</span><span class="n">zf</span><span class="p">,</span><span class="n">Af</span><span class="p">,</span><span class="n">nmr</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error is </span><span class="si">{</span><span class="n">fit</span><span class="p">[</span><span class="s2">&quot;fun&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> (should be small– otherwise adjust initial guess)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error is 1.5334372109582631e-07 (should be small– otherwise adjust initial guess)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Plot the results</span>
<span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">z0</span><span class="p">,</span><span class="n">A0</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>
    <span class="n">hdl0</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">z0</span><span class="p">,</span><span class="n">z0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">A0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input&#39;</span> <span class="k">if</span> <span class="n">z0</span><span class="o">==</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
<span class="k">for</span> <span class="n">z0</span><span class="p">,</span><span class="n">A0</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">zf</span><span class="p">,</span><span class="n">Af</span><span class="p">):</span>
    <span class="n">hdl1</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">z0</span><span class="p">,</span><span class="n">z0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">A0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span> <span class="k">if</span> <span class="n">z0</span><span class="o">==</span><span class="n">zf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$z=\log_</span><span class="si">{10}</span><span class="s1">(\tau_i/\mathrm</span><span class="si">{s}</span><span class="s1">)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$A_i$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Input vs. fitted correlation times and amplitudes&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)),</span><span class="n">R</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Rc</span><span class="p">)),</span><span class="n">Rc</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Rc</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Input vs. fitted rate constants&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b7b6c6ee92364bef4e2199d8a98b7e8fa8e316a19806e0144407c43e42d725ea.png" src="_images/b7b6c6ee92364bef4e2199d8a98b7e8fa8e316a19806e0144407c43e42d725ea.png" />
<img alt="_images/11e31c2f579e6ad06c7bc12d9a0f68a7c222965b3f65b1b12ffa4fa51b7a67cf.png" src="_images/11e31c2f579e6ad06c7bc12d9a0f68a7c222965b3f65b1b12ffa4fa51b7a67cf.png" />
</div>
</div>
<p>The data is well-fit, but the parameters themselves are not well determined, so we try again with a reduced number of variables, to see what happens.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span><span class="o">=</span><span class="n">minimize</span><span class="p">(</span><span class="n">fun</span><span class="p">,[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mf">8.5</span><span class="p">,</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.01</span><span class="p">],</span><span class="n">bounds</span><span class="o">=</span><span class="p">([</span><span class="o">-</span><span class="mi">14</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">],[</span><span class="o">-</span><span class="mi">14</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>   
<span class="n">zf</span><span class="p">,</span><span class="n">Af</span><span class="o">=</span><span class="n">fit</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][:</span><span class="mi">2</span><span class="p">],</span><span class="n">fit</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">Rc</span><span class="o">=</span><span class="n">calcR</span><span class="p">(</span><span class="n">zf</span><span class="p">,</span><span class="n">Af</span><span class="p">,</span><span class="n">nmr</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error is </span><span class="si">{</span><span class="n">fit</span><span class="p">[</span><span class="s2">&quot;fun&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> (should be small– otherwise adjust initial guess)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error is 4.299710895100029e-07 (should be small– otherwise adjust initial guess)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Plot the results</span>
<span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">z0</span><span class="p">,</span><span class="n">A0</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>
    <span class="n">hdl0</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">z0</span><span class="p">,</span><span class="n">z0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">A0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input&#39;</span> <span class="k">if</span> <span class="n">z0</span><span class="o">==</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
<span class="k">for</span> <span class="n">z0</span><span class="p">,</span><span class="n">A0</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">zf</span><span class="p">,</span><span class="n">Af</span><span class="p">):</span>
    <span class="n">hdl1</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">z0</span><span class="p">,</span><span class="n">z0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">A0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span> <span class="k">if</span> <span class="n">z0</span><span class="o">==</span><span class="n">zf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$z=\log_</span><span class="si">{10}</span><span class="s1">(\tau_i/\mathrm</span><span class="si">{s}</span><span class="s1">)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$A_i$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Input vs. fitted correlation times and amplitudes&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)),</span><span class="n">R</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Rc</span><span class="p">)),</span><span class="n">Rc</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Rc</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Input vs. fitted rate constants&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/751130e6a01cbecfb0590f1e82dba8eee8799512361f5617f79e857941d3286d.png" src="_images/751130e6a01cbecfb0590f1e82dba8eee8799512361f5617f79e857941d3286d.png" />
<img alt="_images/11e31c2f579e6ad06c7bc12d9a0f68a7c222965b3f65b1b12ffa4fa51b7a67cf.png" src="_images/11e31c2f579e6ad06c7bc12d9a0f68a7c222965b3f65b1b12ffa4fa51b7a67cf.png" />
</div>
</div>
<p>The two fits are nearly equal in quality, whereas only the second yields stable parameters, due to the fewer number of free variables. However, neither fit really reproduces the input correlation times and amplitudes. There isn’t enough information to extract 6 parameters, and so we get parameters that represent some kind of compromise to match the real motion. This is discussed in detail in:</p>
<p>A. A. Smith, M. Ernst, B. H. Meier. <a class="reference external" href="https://doi.org/10.1002/ange.201707316">Because the light is better here: correlation-time analysis by NMR.</a> Angew. Chem. Int. Ed. 2017, 56, 13778-13783.</p>
<p>If it was just a matter of fitting three correlation times instead of two, we might be able to solve this problem by simply obtaining additional experimental data. However, the real problem is that we often have continua of correlation times (hence why we suggest using a distribution of correlation times above, <span class="math notranslate nohighlight">\((1-S^2)\theta(z)\)</span>. Without a model of the correlation function that both accurately describes the motion and has sufficiently few parameters, we fail to be able to get really meaningful dynamics parameters. Furthermore, for proteins, which have a complex structure, it is highly non-trivial to get a good model.</p>
<p>To address this problem, we have developed the <strong>detector</strong> analysis, which we introduce here.</p>
</div>
<div class="section" id="basic-detector-theory">
<h2>Basic detector theory<a class="headerlink" href="#basic-detector-theory" title="Permalink to this heading">#</a></h2>
<p>Suppose that our correlation function is given by an arbitrarily complex sum of decaying exponential terms. We’ll take this to be the rank-2 tensor correlation function used in NMR (here, that just means we assume an initial value of one, and value at <span class="math notranslate nohighlight">\(t=\infty\)</span> of <span class="math notranslate nohighlight">\(S^2\)</span>). Then, this can be written as a distribution of correlation times</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
C(t)=S^2+(1-S^2)\int\limits_{-\infty}^\infty{\theta(z)\exp(-t/(10^z\cdot\mathrm{1 s}))dz}
\end{equation}
\]</div>
<p>The distribution, <span class="math notranslate nohighlight">\((1-S^2)\theta(z)\)</span>, can be assumed to be a sum of <span class="math notranslate nohighlight">\(\delta\)</span>-functions, allowing it to also be re-written as a sum of correlation times:</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
C(t)=S^2+(1-S^2)\sum\limits_i{A_i\exp(-t/\tau_i)}
\end{equation}
\]</div>
<p>Then, a given relaxation rate constant is given by</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
R_\zeta^{(\theta,S)}=\sum\limits_i{a_\zeta^iJ^{(\theta,S)}(\omega_i)}
\end{equation}
\]</div>
<p>The spectral density, <span class="math notranslate nohighlight">\(J^{(\theta,S)}(\omega)\)</span> is, indeed, a function of the distribution of correlation times, given by</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
J^{(\theta,S)}(\omega)=2(1-S^2)\int\limits_{-\infty}^\infty{\theta(z)\frac{10^z\cdot\mathrm{1 s}}{1+(\omega\cdot10^z\cdot\mathrm{1 s})^2}dz}
\end{equation}
\]</div>
<p>Then, a given relaxation rate constant can be written as a function of the distribution of correlation times:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
R_\zeta^{(\theta,S)}&amp;=&amp;\sum\limits_i{a_\zeta^iJ^{(\theta,S)}(\omega_i)} \\
&amp;=&amp;\sum\limits_i{a_\zeta^i2(1-S^2)\int\limits_{-\infty}^\infty{\theta(z)\frac{10^z\cdot\mathrm{1 s}}{1+(\omega_i\cdot10^z\cdot\mathrm{1 s})^2}}dz}\\
&amp;=&amp;(1-S^2)\int\limits_{-\infty}^\infty{2\sum\limits_i{a_\zeta^i\frac{10^z\cdot\mathrm{1 s}}{1+(\omega_i\cdot10^z\cdot\mathrm{1 s})^2}}dz}\\
&amp;=&amp;(1-S^2)\int\limits_{-\infty}^\infty{\theta(z)R_\zeta(z)dz}
\end{eqnarray}
\end{split}\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
R_\zeta(z)=2\sum\limits_i{a_\zeta^i\frac{10^z\cdot\mathrm{1 s}}{1+(\omega_i\cdot10^z\cdot\mathrm{1 s})^2}}
\end{equation}
\]</div>
<p>While the math may seem a bit overwhelming at first, all we’ve really done is a little shuffling of terms. We point out that a given relaxation rate constant is sensitive to certain correlation times more than others, and its measurement basically provides us a ‘window’, given by <span class="math notranslate nohighlight">\(R_\zeta(z)\)</span>, into the total dynamics. We have termed this window a <em>detector sensitivity</em>, which looks at only a certain range of correlation times, as defined by the integral above. pyDR automatically calculates these windows, as shown below, for a <span class="math notranslate nohighlight">\(^{15}\)</span>N <span class="math notranslate nohighlight">\(T_1\)</span> (protein backbone) acquired at 600 MHz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="o">=</span><span class="n">pyDR</span><span class="o">.</span><span class="n">Sens</span><span class="o">.</span><span class="n">NMR</span><span class="p">(</span><span class="n">Type</span><span class="o">=</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span><span class="n">Nuc</span><span class="o">=</span><span class="s1">&#39;15N&#39;</span><span class="p">,</span><span class="n">v0</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span><span class="o">.</span><span class="n">plot_Rz</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/59e0b4e1d4951f49ceb064b901e2764d4e0984b595a7b59edb430e906e238b22.png" src="_images/59e0b4e1d4951f49ceb064b901e2764d4e0984b595a7b59edb430e906e238b22.png" />
</div>
</div>
<p>As one sees, measurement of this <span class="math notranslate nohighlight">\(T_1\)</span> lets us characterize dynamics <em>around</em> roughly 1 ns.</p>
<p>Interestingly, if we have multiple relaxation rate constants, we may add them together to get new windows. For example, we define:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\rho_n^{(\theta,S)}&amp;=&amp;\sum\limits_\zeta{b_\zeta^n R_\zeta^{(\theta,S)}} \\
&amp;=&amp;\sum\limits_\zeta{b_\zeta^n(1-S^2)\int\limits_{-\infty}^\infty{\theta(z)R_\zeta(z)dz}} \\
&amp;=&amp;(1-S^2)\int\limits_{-\infty}^\infty{\theta(z)\sum\limits_\zeta{b_\zeta^n R_\zeta(z)}dz}\\
&amp;=&amp;(1-S^2)\int\limits_{-\infty}^\infty{\theta(z)\rho_n(z)dz}
\end{eqnarray}
\end{split}\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\rho_n(z)=\sum\limits_\zeta{b_\zeta^n R_\zeta(z)}
\end{equation}
\]</div>
<p>The superscript <span class="math notranslate nohighlight">\(n\)</span> just indicates that there are multiple possible linear combinations of relaxation rate constants. Each linear combination creates a new window, but most possible windows may not be particularly useful. For example, we take two relaxation rate constants below, and show a random set of linear combinations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nmr</span><span class="o">=</span><span class="n">pyDR</span><span class="o">.</span><span class="n">Sens</span><span class="o">.</span><span class="n">NMR</span><span class="p">(</span><span class="n">Type</span><span class="o">=</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span><span class="n">v0</span><span class="o">=</span><span class="p">[</span><span class="mi">40</span><span class="p">,</span><span class="mi">800</span><span class="p">],</span><span class="n">Nuc</span><span class="o">=</span><span class="s1">&#39;15N&#39;</span><span class="p">)</span>
<span class="n">rho_0</span><span class="o">=</span><span class="n">nmr</span><span class="o">.</span><span class="n">rhoz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">-</span><span class="mf">.5</span><span class="p">)</span><span class="o">+</span><span class="n">nmr</span><span class="o">.</span><span class="n">rhoz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">-</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">rho_1</span><span class="o">=</span><span class="n">nmr</span><span class="o">.</span><span class="n">rhoz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">-</span><span class="mf">.5</span><span class="p">)</span><span class="o">+</span><span class="n">nmr</span><span class="o">.</span><span class="n">rhoz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">-</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">nmr</span><span class="o">.</span><span class="n">tc</span><span class="p">,</span><span class="n">rho_0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">nmr</span><span class="o">.</span><span class="n">tc</span><span class="p">,</span><span class="n">rho_1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\tau_c$ / s&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\rho_n(z)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/077b896004ae7bfacb4e4a8d49a9b26a184baa01eb937a81d35207016ac033e5.png" src="_images/077b896004ae7bfacb4e4a8d49a9b26a184baa01eb937a81d35207016ac033e5.png" />
</div>
</div>
<p>However, pyDR is designed to yield the optimal <span class="math notranslate nohighlight">\(n\)</span> windows for a given data set, for example, for the two experiments, we get two optimized windows (The number of optimized windows is always less than or equal to the number of experiments)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="o">=</span><span class="n">nmr</span><span class="o">.</span><span class="n">Detector</span><span class="p">()</span><span class="o">.</span><span class="n">r_auto</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">plot_rhoz</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/903cd111b9d49ea025ccb50d5fded92ea8c9d57dd8d6d0bd7175ea4eed30805d.png" src="_images/903cd111b9d49ea025ccb50d5fded92ea8c9d57dd8d6d0bd7175ea4eed30805d.png" />
</div>
</div>
<p>Formally, the linear combination of rate constants (or any other parameter depending linearly on the correlation function) is referred to as a <em>detector response</em> (<span class="math notranslate nohighlight">\(\rho_n^{(\theta,S)}\)</span>), and the linear combination of sensitivities of the rate constants as <em>detector sensitivities</em> (<span class="math notranslate nohighlight">\(\rho_n(z)\)</span>). In the next chapter, we discuss how the windows are actually optimized.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="notebooks.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Content with notebooks</p>
      </div>
    </a>
    <a class="right-next"
       href="Ch2_detector_opt.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><font color="maroon">Chapter 2: Detector Optimization</font></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#models-for-decaying-correlation-functions">Models for decaying correlation functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-angular-correlation-function-for-nmr">The angular correlation function for NMR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-dynamics-data">Fitting dynamics data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-detector-theory">Basic detector theory</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>